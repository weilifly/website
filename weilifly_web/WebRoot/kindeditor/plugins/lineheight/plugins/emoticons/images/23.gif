»åŠ 
		//å•†å“ç±»å‹ 1 æ™®é€šä¸»å•†å“ 2æ™®é€šå‰¯å•†å“  3æ™®é€šç«‹å³è´­ä¹°4 é¢„çº¦å•†å“ 5æŠ¢è´­å•†å“
		Integer type = -1 ;
		productid = Convert.strToLong(request("productid"), -1L) ;
		Integer product_num = Convert.strToInt(request("product_num"), -1) ;
		Long colorid = Convert.strToLong(request("colorid"), -1L) ;
		Long userid = (Long)session(IConstants.SESSION_USER_ID) ;
		Long cart_time = Convert.strToLong(request("cart_time"), -1L) ;
		if(userid==null){
			msgflag=1;
			message = "æ‚¨è¿˜æœªç™»é™†ï¼Œè¯·å…ˆç™»å½•!" ;
			return LOGIN ;
		}
        Long cartid  = -1L;
		
	
		Map<String,String> pMap = productService.queryProductById(productid);
		if(pMap==null){
			 msgflag=2;
			 message = "æäº¤çš„æ•°æ®æœ‰è¯¯ï¼Œè¯·é‡æ–°æäº¤!" ;
			 return INPUT ;
		}
		
		Integer sale_type = Convert.strToInt(pMap.get("product_saletype"), -1) ;
		if(sale_type==IConstants.PRODUCT_SALTYPE_ORDER){
			type = IConstants.CART_TYPE_APPOINT_IMM ;//é¢„çº¦ç«‹å³è´­ä¹°
			boolean bool =  checkBuyNum(userid,productid) ;
			if(!bool){
				msgflag=3;
				message = "è¯¥å•†å“ä¸ºé¢„çº¦å•†å“ï¼Œæ¯ä¸ªè´¦å·ä»…é™è´­ä¹°ä¸€æ¬¡" ;
				return INPUT ;
			}
		}
		if(sale_type==IConstants.PRODUCT_SALTYPE_PANIC){
			type = IConstants.CART_TYPE_PANIC_IMM ;//æŠ¢è´­ç«‹å³è´­ä¹°
			boolean bool =  checkBuyNum(userid,productid) ;
			if(!bool){
				msgflag=4;
				message = "è¯¥å•†å“ä¸ºæŠ¢è´­å•†å“ï¼Œæ¯ä¸ªè´¦å·ä»…é™è´­ä¹°ä¸€æ¬¡" ;
				return INPUT ;
			}
		}
		if(sale_type==IConstants.PRODUCT_SALTYPE_COMMON){
			type = IConstants.CART_TYPE_COMM_IMM ;//æ™®é€šç«‹å³è´­ä¹°
			Map<String,String> totalMap =productService.queryProductTotalInt(sale_type, productid, product_num, userid) ;
			if(totalMap!=null){
				Integer integration_flag  = Convert.strToInt(totalMap.get("inte_flag"), -1) ;
				if(integration_flag!=null&&integration_flag!=1){
					 msgflag=5;
					 message = "è´­ä¹°è¯¥å•†å“éœ€è¦ç§¯åˆ†ï¼Œæ‚¨